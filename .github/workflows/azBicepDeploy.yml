## Deploy Azure Resource using bicep

name: Azure Deployment

on:
    workflow_dispatch:

    push:
        branches:
            - main

permissions:
    id-token: write
    contents: read

env:
    azCliVersion: 2.5.72
    ## environment: 'azBicepDeployment'
            
jobs:
    # Validate the Bicep templates
    validateDeployment:
        runs-on: ubuntu-latest
        
        steps:
            - uses: action/checkout@main
              name: Checkout

            - uses: azure/login@v1
              name: Azure Login
              with:
                creds: ${{ secrets.AZURE_CREDENTIALS }}

            - uses: azure/cli@v1
              name: Azure CLI
              with:
                azcliversion: $azCliVersion
                inlineScript: |
                    az deployment sub validate --location westeurope --template-file ./azDeployment.bicep
            
            - uses: azure/cli@v1
              name: Azure CLI
              with:
                azcliversion: $azCliVersion
                inlineScript: |
                    az deployment sub create --location westeurope --template-file ./azDeployment.bicep --what-if --verbose
    
    # # Deploy the resources
    # deployResources:
    #     runs-on: ubuntu-latest
    #     ## environment: $environment
    #     needs: [
    #       validateDeployment
    #     ]
        
    #     steps:
    #         - uses: action/checkout@v4
    #           name: Checkout

    #         - uses: azure/login@v1
    #           name: Azure Login
    #           with:
    #             creds: ${{ secrets.AZURE_CREDENTIALS }}

    #         - uses: azure/cli@v1
    #           name: Azure CLI
    #           with:
    #             azcliversion: ${{ env.azCliVersion }}
    #             inlineScript: |
    #                 az deployment sub create --location westeurope --template-file ./azDeployment.bicep --verbose
